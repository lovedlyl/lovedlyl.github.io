$(function(){var a=($("form"),$("#cardType")),e=$("#cardNum"),n=$("#cardPwd"),t=$("#phoneNum"),i=$("#vcode"),o=$("#name"),s=$("#vCardType"),r=$("#vCardNum"),c=$("#gender"),l=$("#dateOfBirth"),d=[a,e,t,o,s,r,c,l],u=[];$.each(d,function(a,e){0!=e.length&&u.push(e)});var f=function(a,e){a.siblings(".tooltip").find(".info").text(e),a.get(0).focus()},v=function(a){$(".warning").text(a)},p=function(a,e){a.children("li").removeClass("on").eq(e).addClass("on")};$(".select .icon, .select ul").modal({space:20,mock:"#submit"}),function(){var c=-1!==$.inArray(a,u),l=-1!==$.inArray(t,u),d=-1!==$.inArray(s,u),p=function(){var a={0:"身份证",1:"护照",2:"军官证或士兵证",3:"港澳通行证/回乡证/台胞证",4:"户口本",5:"其他"};return $.ajax({type:"POST",url:"???????????????",dataType:"json",contentType:"application/json",data:{request:"idTypes????????"},error:function(a){},success:function(e){a=JSON.parse(e)}}),a};if(d){var h="",m=p();$.each(m,function(a,e){h+=0==a?"<li class='on'>"+e+"</li>":"<li>"+e+"</li>"}),s.html(h)}!function(){var a,e=function(){clearInterval(a),s=60,o.removeClass("disabled").text("重新获取"),o.on("tap",n)},n=function(i){i.preventDefault();var r=t.val(),c=t.validate("phoneNo");return c.fail?void f(t,c.fail):(o.addClass("disabled").off("tap",n).text(s+"秒后重试"),void $.ajax({type:"POST",url:"???????????????",dataType:"json",contentType:"application/json",data:{phoneNo:r,request:"validateNo???????"},error:function(a){v("获取验证码失败！"),e()},success:function(n){"success"==n.status&&(a=setInterval(function(){s-=1,o.text(s+"秒后重试"),0>=s&&e()},1e3)),"fail"==n.status&&e()}}))},o=i.siblings(".btn"),s=(o.text(),60);o.on("tap",n),o.on("click",function(a){a.preventDefault()})}();var N,b,y,g=$("#submit"),x="test.json???????????????????",k=function(){g.off("tap",N),$.ajax({type:"POST",url:x,dataType:"json",contentType:"application/json",data:y,success:C,error:T})},C=function(a){"success"==a.status?location.href="/success.html":(g.on("tap",N),v(a.msg))},T=function(a){g.on("tap",N),v("请求失败，请稍后再试！")},S=function(){for(var a=!0,e=0;e<b.length;e++){var n=b[e];if("empty"==n.attr("class")){n.addClass("untouched"),f(n,n.get(0).placeholder),a=!1;break}if(n.hasClass("empty untouched")){a=!1;break}if(n.hasClass("invalid")){var t=n.siblings("label").text();f(n,t+"格式有误！"),a=!1;break}}return a};if(c){var j=e.val(),w=n.val(),D=a.children("li.on").index();N=function(a){a.preventDefault(),b=[e,n],S()&&(y={cardNo:j,password:w,cardType:D},k())}}if(l){var O=t.val(),P=i.val();N=function(a){a.preventDefault(),b=[t,i],S()&&(y={phoneNo:O,validateNo:P},k())}}if(d){var q=o.val(),A=r.val(),B=s.children("li.on").index();N=function(a){a.preventDefault(),b=[o,r],S()&&(y={cnNname:q,idNo:A,idType:B},C=function(a){if(a=JSON.parse(a),"success"==a.status){var e=a.userType;"普通用户"==e?location.href="/phone.html":location.href="/account.html"}"fail"==a.status&&(g.on("tap",N),v(a.msg))},k())}}g.on("tap",N)}(),function(){var e=$("input"),n=function(e){e.preventDefault();var n,t=$(this),i=t.attr("id"),o=function(a){p(c,1&a.gender),l.val(a.dob)};switch(i){case"phoneNum":n=t.validate("phoneNo");break;case"vcode":n=t.validate("vCode");break;case"cardNum":0==a.children("li.on").index()&&(n=t.validate("bankNo")),1==a.children("li.on").index()&&(n=t.validate("bankNo"));break;case"cardPwd":0==a.children("li.on").index()&&(n=t.validate("bankPwd")),1==a.children("li.on").index()&&(n=t.validate("bankPwd"));break;case"name":n=t.validate("cnName");break;case"vCardNum":n=0==s.children("li.on").index()?t.validate("idNo"):t.validate("No");break;case"dateOfBirth":n=t.validate("dob")}n.fail?f(t,n.fail):"vCardNum"==i&&0==s.children("li.on").index()&&o(n.success)};e.addClass("empty").on("input",n),e.on("focus",function(a){v("")})}(),function(){var a=function(){sessionStorage&&$.each(u,function(a,e){var n=e[0].tagName.toLowerCase(),t=e.selector.slice(1);if("input"==n){var i=sessionStorage[t];i&&e.val(i)}if("ul"==n){var o=sessionStorage[t];void 0!==o&&p(e,o)}})};a();var e=function(){sessionStorage&&$.each(u,function(a,e){var n=e[0].tagName.toLowerCase(),t=e.selector.slice(1);if("input"==n){var i=e.val();sessionStorage[t]=i}if("ul"==n){var o=e.find("li.on").index();sessionStorage[t]=o}})};$(".header .icon-circle").on("tap",function(a){a.preventDefault(),e(),history.go(-1)})}()});