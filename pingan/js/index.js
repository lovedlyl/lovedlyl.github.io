$(function(){var a=($("form"),$("#cardType")),e=$("#cardNum"),n=$("#cardPwd"),t=$("#phoneNum"),i=$("#vcode"),o=$("#name"),s=$("#vCardType"),c=$("#vCardNum"),r=$("#gender"),l=$("#dateOfBirth"),d=[a,e,t,o,s,c,r,l],u=[];$.each(d,function(a,e){0!=e.length&&u.push(e)});var f=function(a,e){a.siblings(".tooltip").find(".info").text(e),a.get(0).focus()},v=function(a){$(".warning").text(a)},p=function(a,e){a.children("li").removeClass("on").eq(e).addClass("on")};$(".select .icon, .select ul").modal({space:20,mock:"#submit"}),function(){var r=-1!==$.inArray(a,u),l=-1!==$.inArray(t,u),d=-1!==$.inArray(s,u),p=function(){var a={0:"身份证",1:"护照",2:"军官证或士兵证",3:"港澳通行证/回乡证/台胞证",4:"户口本",5:"其他"};return $.ajax({method:"POST",url:"???????????????",dataType:"json",contentType:"application/json",data:{request:"idTypes????????"},error:function(a){},success:function(e){a=JSON.parse(e)}}),a};if(d){var h="",m=p();$.each(m,function(a,e){h+=0==a?"<li class='on'>"+e+"</li>":"<li>"+e+"</li>"}),s.html(h)}!function(){var a,e=function(){clearInterval(a),o=60,t.removeClass("disabled").text("重新获取"),t.on("tap",n)},n=function(i){i.preventDefault(),t.addClass("disabled").off("tap",n).text(o+"秒后重试"),$.ajax({method:"POST",url:"???????????????",dataType:"json",contentType:"application/json",data:{request:"validateNo???????"},error:function(a){v("获取验证码失败！"),e()},success:function(n){"success"==n.status&&(a=setInterval(function(){o-=1,t.text(o+"秒后重试"),0>=o&&e()},1e3)),"fail"==n.status&&e()}})},t=i.siblings(".btn"),o=(t.text(),60);t.on("tap",n),t.on("click",function(a){a.preventDefault()})}();var b,N,g,x=$("#submit"),y="test.json???????????????????",k=function(){x.off("click",b),$.ajax({method:"POST",url:y,dataType:"json",contentType:"application/json",data:g,success:C,error:T})},C=function(a){"success"==a.status?location.href="/success.html":(x.on("tap",b),v(a.msg))},T=function(a){x.on("click",b),v("请求失败，请稍后再试！")},S=function(){for(var a=!0,e=0;e<N.length;e++){var n=N[e];if("empty"==n.attr("class")){n.addClass("untouched"),f(n,n.get(0).placeholder),a=!1;break}if(n.hasClass("empty untouched")){a=!1;break}if(n.hasClass("invalid")){var t=n.siblings("label").text();f(n,t+"格式有误！"),a=!1;break}}return a};if(r){var j=e.val(),w=n.val(),D=a.children("li.on").index();b=function(a){a.preventDefault(),N=[e,n],S()&&(g={cardNo:j,password:w,cardType:D},k())}}if(l){var O=t.val(),P=i.val();b=function(a){a.preventDefault(),N=[t,i],S()&&(g={phoneNo:O,validateNo:P},k())}}if(d){var q=o.val(),A=c.val(),B=s.children("li.on").index();b=function(a){a.preventDefault(),N=[o,c],S()&&(g={cnNname:q,idNo:A,idType:B},C=function(a){if(a=JSON.parse(a),"success"==a.status){var e=a.userType;"普通用户"==e?location.href="/phone.html":location.href="/account.html"}"fail"==a.status&&(x.on("tap",b),v(a.msg))},k())}}x.on("tap",b)}(),function(){var e=$("input"),n=function(e){e.preventDefault();var n,t=$(this),i=t.attr("id"),o=function(a){p(r,1&a.gender),l.val(a.dob)};switch(i){case"phoneNum":n=t.validate("phoneNo");break;case"vcode":n=t.validate("vCode");break;case"cardNum":0==a.children("li.on").index()&&(n=t.validate("bankNo")),1==a.children("li.on").index()&&(n=t.validate("bankNo"));break;case"cardPwd":0==a.children("li.on").index()&&(n=t.validate("bankPwd")),1==a.children("li.on").index()&&(n=t.validate("bankPwd"));break;case"name":n=t.validate("cnName");break;case"vCardNum":n=0==s.children("li.on").index()?t.validate("idNo"):t.validate("No");break;case"dateOfBirth":n=t.validate("dob")}n.fail?f(t,n.fail):"vCardNum"==i&&0==s.children("li.on").index()&&o(n.success)};e.addClass("empty").on("input",n),e.on("focus",function(a){v("")})}(),function(){var a=function(){sessionStorage&&$.each(u,function(a,e){var n=e[0].tagName.toLowerCase(),t=e.selector.slice(1);if("input"==n){var i=sessionStorage[t];i&&e.val(i)}if("ul"==n){var o=sessionStorage[t];void 0!==o&&p(e,o)}})};a();var e=function(){sessionStorage&&$.each(u,function(a,e){var n=e[0].tagName.toLowerCase(),t=e.selector.slice(1);if("input"==n){var i=e.val();sessionStorage[t]=i}if("ul"==n){var o=e.find("li.on").index();sessionStorage[t]=o}})};$(".header .icon-circle").on("tap",function(a){a.preventDefault(),e(),history.go(-1)})}()});