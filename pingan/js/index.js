$(function(){var a=($("form"),$("#cardType")),e=$("#cardNum"),n=$("#cardPwd"),i=$("#phoneNum"),o=$("#vcode"),t=$("#name"),r=$("#vCardType"),s=$("#vCardNum"),c=$("#gender"),l=$("#dateOfBirth"),d=[a,e,i,t,r,s,c,l],u=[];$.each(d,function(a,e){0!=e.length&&u.push(e)});var v=$(".warning"),f=function(a){v.text(a)},h=function(a,e){a.children("li").removeClass("on").eq(e).addClass("on")};$(".select .icon, .select ul").modal({space:20,mock:"#submit"}),function(){var c,l,d,v=-1!==$.inArray(a,u),h=-1!==$.inArray(i,u),p=-1!==$.inArray(r,u),m=$("#submit"),N="test.json",g=function(){m.off("click",c),$.ajax({method:"POST",url:N,dataType:"json",contentType:"application/json",data:d,success:b,error:C})},b=function(a){"success"==a.status?location.href="/success.html":(m.on("tap",c),f(a.msg))},C=function(a){m.on("click",c),f("请求失败，请稍后再试！")},y=function(){for(var a=0;a<l.length;a++){var e=l[a];if(e.hasClass("empty"))return e.addClass("invalid"),f(e.get(0).placeholder),e.focus(),!1;if(e.hasClass("invalid")){var n=e.siblings("label").text();return f(n+"格式有误！"),e.focus(),!1}}return!0};if(v){var k=e.val(),x=n.val(),w=a.children("li.on").index();c=function(a){a.preventDefault(),l=[e,n],y()&&(d={cardNo:k,password:x,cardType:w},g())}}if(h){var S=i.val(),T=o.val();c=function(a){a.preventDefault(),l=[i,o],y()&&(d={phoneNo:S,validateNo:T},g())}}if(p){var D=t.val(),P=s.val(),j=r.children("li.on").index();c=function(a){a.preventDefault(),l=[t,s],y()&&(d={cnNname:D,idNo:P,idType:j},b=function(a){if(a=JSON.parse(a),"success"==a.status){var e=a.userType;"普通用户"==e?location.href="/phone.html":location.href="/account.html"}"fail"==a.status&&(m.on("tap",c),f(a.msg))},g())}}m.on("tap",c)}(),function(){var e=$("input"),n=function(e){e.preventDefault();var n,i=$(this),o=i.attr("id"),t=function(a){h(c,1&a.gender),l.val(a.dob)};switch(o){case"phoneNum":n=i.validate("phoneNo");break;case"vcode":n=i.validate("vCode");break;case"cardNum":0==a.children("li.on").index()&&(n=i.validate("bankNo")),1==a.children("li.on").index()&&(n=i.validate("bankNo"));break;case"cardPwd":0==a.children("li.on").index()&&(n=i.validate("bankPwd")),1==a.children("li.on").index()&&(n=i.validate("bankPwd"));break;case"name":n=i.validate("cnName");break;case"vCardNum":n=0==r.children("li.on").index()?i.validate("idNo"):i.validate("No");break;case"dateOfBirth":n=i.validate("dob")}n.fail?(f(n.fail),i.addClass("invalid"),i.focus()):(i.removeClass("invalid empty"),f(""),"vCardNum"==o&&0==r.children("li.on").index()&&t(n.success))};e.addClass("empty").on("input",n)}(),function(){var a=function(){sessionStorage&&$.each(u,function(a,e){var n=e[0].tagName.toLowerCase(),i=e.selector.slice(1);if("input"==n){var o=sessionStorage[i];o&&e.val(o)}if("ul"==n){var t=sessionStorage[i];void 0!==t&&h(e,t)}})};a();var e=function(){sessionStorage&&$.each(u,function(a,e){var n=e[0].tagName.toLowerCase(),i=e.selector.slice(1);if("input"==n){var o=e.val();sessionStorage[i]=o}if("ul"==n){var t=e.find("li.on").index();console.log(t),sessionStorage[i]=t}})};$(".header .icon-circle").on("tap",function(a){a.preventDefault(),e(),history.go(-1)})}()});